{"version":3,"sources":["reducer.js","Components/Screens/Global/OrderTotal.jsx","Components/Screens/Checkout/Paypal/Paypal.jsx","Components/Screens/Checkout/Pay.jsx"],"names":["getBasketTotal","basket","reduce","amount","item","price","quantity","OrderTotal","navigate","useNavigate","state","useStateValue","setBasket","useState","error","setError","userAPI","data","postalData","deliveryOption","setTimeout","className","length","style","color","fontSize","map","i","title","display","justifyContent","fontWeight","deliveryPrice","parseFloat","toFixed","onClick","to","Paypal","onSuccess","onCancel","onError","total","loading","deferLoading","options","locale","currency","fundingSource","FUNDING","PAYPAL","onApprove","createOrder","actions","console","log","order","create","purchase_units","value","layout","label","height","Pay","token","email","lastName","name","phone","userID","postalCode","address","building","checkPhone","checkEmail","checkName","paymentOption","takeaway","setDeferLoading","totalWithDelivery","setTotalWithDelivery","useEffect","transactionSuccess","paymentData","a","time","Date","now","axios","post","orders","orderNumber","paymentID","orderID","paymentDetails","deliveryCharges","paymentStatus","orderStatus","headers","Authorization","then","response","transactionSuccessTakeaway","orderSubmit","orderSubmitTakeaway","transactionError","transactionCancel","minOrder","parseInt","e","padding","margin","Footer"],"mappings":"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","file":"static/js/13.c623e35e.chunk.js","sourcesContent":["export const getBasketTotal = (basket) => {\r\n  return basket?.reduce(\r\n    (amount, item) => item.price * item.quantity + amount,\r\n    0\r\n  );\r\n};\r\n","import React, { useState } from \"react\";\r\nimport \"./OrderTotal.css\";\r\nimport { getBasketTotal } from \"../../../reducer\";\r\nimport ShoppingBasketRoundedIcon from \"@mui/icons-material/ShoppingBasketRounded\";\r\nimport { useStateValue } from \"../../../StateProvider\";\r\nimport { useNavigate, Link } from \"react-router-dom\";\r\n\r\nconst OrderTotal = () => {\r\n\tconst navigate = useNavigate();\r\n\tconst state = useStateValue();\r\n\tconst [basket, setBasket] = state.basket;\r\n\tconst [error, setError] = useState(null);\r\n\tconst { userAPI } = useStateValue();\r\n\tconst [data] = userAPI.postalData;\r\n\tconst [deliveryOption] = userAPI.deliveryOption;\r\n\r\n\tconst emptyBasket = () => {\r\n\t\tsetBasket([]);\r\n\t};\r\n\r\n\tconst checkoutClick = () => {\r\n\t\tif (basket.length > 0) {\r\n\t\t\tnavigate(\"/checkout\");\r\n\t\t}\r\n\t};\r\n\r\n\tif (error) {\r\n\t\tsetTimeout(() => {\r\n\t\t\tsetError(null);\r\n\t\t}, 2000);\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div className=\"order__right-section\">\r\n\t\t\t<div className=\"order__right-section-content\">\r\n\t\t\t\t<h2 className=\"orderTotal__title\">\r\n\t\t\t\t\t{basket?.length} items in Cart\r\n\t\t\t\t\t<ShoppingBasketRoundedIcon\r\n\t\t\t\t\t\tstyle={{ color: \"#d70f64\", fontSize: \"xx-large\" }}\r\n\t\t\t\t\t/>\r\n\t\t\t\t</h2>\r\n\t\t\t\t{basket?.map((item, i) => (\r\n\t\t\t\t\t<div key={i} className=\"order__total-list\">\r\n\t\t\t\t\t\t<p className=\"order__total-title\">{item?.title}</p>\r\n\t\t\t\t\t\t<p className=\"order__total-price\">\r\n\t\t\t\t\t\t\t<span className=\"order__total-list-text\">\r\n\t\t\t\t\t\t\t\tx{item?.quantity}\r\n\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t{item?.price} €\r\n\t\t\t\t\t\t</p>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t))}\r\n\r\n\t\t\t\t<div\r\n\t\t\t\t\tclassName=\"order__total-list\"\r\n\t\t\t\t\tstyle={{\r\n\t\t\t\t\t\tdisplay: deliveryOption === \"takeaway\" ? \"none\" : \"flex\",\r\n\t\t\t\t\t\tjustifyContent: \"flex-end\",\r\n\t\t\t\t\t}}>\r\n\t\t\t\t\t{/* <p className=\"order__total-title\"></p> */}\r\n\t\t\t\t\t<p\r\n\t\t\t\t\t\tclassName=\"order__total-price\"\r\n\t\t\t\t\t\tstyle={{ fontSize: \"large\", fontWeight: \"bold\" }}>\r\n\t\t\t\t\t\t<span\r\n\t\t\t\t\t\t\tclassName=\"order__total-list-text\"\r\n\t\t\t\t\t\t\tstyle={{ fontSize: \"small\", fontWeight: \"bold\" }}>\r\n\t\t\t\t\t\t\ttassa di consegna\r\n\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t{data?.deliveryPrice}\r\n\t\t\t\t\t</p>\r\n\t\t\t\t</div>\r\n\t\t\t\t<h3 className=\"order__total\">\r\n\t\t\t\t\t<span> Totale </span>\r\n\t\t\t\t\t{parseFloat(getBasketTotal(basket)).toFixed(2)} €\r\n\t\t\t\t</h3>\r\n\t\t\t\t{deliveryOption === \"takeaway\" ? null : data?.deliveryPrice ? (\r\n\t\t\t\t\t<h4 className=\"order__total-fee-text\">\r\n\t\t\t\t\t\twith delivery fee{\" \"}\r\n\t\t\t\t\t\t<span>\r\n\t\t\t\t\t\t\t{(\r\n\t\t\t\t\t\t\t\tparseFloat(getBasketTotal(basket)) +\r\n\t\t\t\t\t\t\t\tparseFloat(data?.deliveryPrice)\r\n\t\t\t\t\t\t\t).toFixed(2)}\r\n\t\t\t\t\t\t</span>\r\n\t\t\t\t\t</h4>\r\n\t\t\t\t) : (\r\n\t\t\t\t\t<h4>Enter Postal Info</h4>\r\n\t\t\t\t)}\r\n\t\t\t\t<div className=\"order__total-btns\">\r\n\t\t\t\t\t<button\r\n\t\t\t\t\t\tclassName=\"order__total-empty-button\"\r\n\t\t\t\t\t\tonClick={emptyBasket}>\r\n\t\t\t\t\t\tCarrello Vuoto\r\n\t\t\t\t\t</button>\r\n\t\t\t\t\t<Link\r\n\t\t\t\t\t\tto={basket.length > 0 ? \"/checkout\" : \"/order\"}\r\n\t\t\t\t\t\tclassName=\"order__total-checkout-button-link\">\r\n\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\tclassName=\"order__total-checkout-button\"\r\n\t\t\t\t\t\t\tonClick={checkoutClick}>\r\n\t\t\t\t\t\t\tPagina di Pagamento\r\n\t\t\t\t\t\t</button>\r\n\t\t\t\t\t</Link>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n};\r\n\r\nexport default OrderTotal;\r\n","import React from \"react\";\r\nimport {\r\n  PayPalScriptProvider,\r\n  PayPalButtons,\r\n  FUNDING,\r\n} from \"@paypal/react-paypal-js\";\r\n// import Loading from \"../../Global/Loading\";\r\n\r\n// const initialOptions = {\r\n//   \"client-id\":\r\n//     \"Ac8o4swJtckfwVOCnGLmPeW4KuApWFOLBx4LLW8TcnUD7t5AkSBU6i1yeuPK822ps6QJt-5gL9swQsWI\",\r\n//   \"merchant-id\": \"UGUFDKZNBH2TN\",\r\n//   \"buyer-country\": \"DE\",\r\n//   currency: \"EURO\",\r\n//   locale: \"de_DE\",\r\n// };\r\n\r\nconst Paypal = ({ onSuccess, onCancel, onError, total, loading, setError }) => {\r\n  // const [{ isPending, isResolved }] = usePayPalScriptReducer();\r\n  return (\r\n    <PayPalScriptProvider\r\n      deferLoading={loading}\r\n      options={{\r\n        // \"client-id\":\r\n        //   \"ATSNzle97H2HdLUL3GMnS5I8PuKouWyteOOCVNR-3UqTW5N_0tFs3ddtDitE1IfqAlRXI4hbaEo2yDT9\",\r\n        \"client-id\":\r\n          \"Ac8o4swJtckfwVOCnGLmPeW4KuApWFOLBx4LLW8TcnUD7t5AkSBU6i1yeuPK822ps6QJt-5gL9swQsWI\",\r\n        // \"merchant-id\": \"92V8XPRZFHZRE\",\r\n        // // \"buyer-country\": \"IT\",\r\n        // // locale: \"de_DE\",\r\n        // locale: \"en_US\",\r\n        locale: \"it_IT\",\r\n        // intent: \"capture\",\r\n        currency: \"EUR\",\r\n      }}>\r\n      <PayPalButtons\r\n        fundingSource={FUNDING.PAYPAL}\r\n        // style={{ layout: \"horizontal\" }}\r\n        // createBillingAgreement={(data) =>\r\n        //   console.log(\"create Billing agreement: \", data)\r\n        // }\r\n        // onApprove={(data) => console.log(\"onApprove: \", data)}\r\n        onApprove={onSuccess}\r\n        onError={onError}\r\n        onCancel={onCancel}\r\n        // onError={(err) => console.log(\"error occured: \", err)}\r\n        // onInit={(data) => console.log(\"on init: \", data)}\r\n        createOrder={(data, actions) => {\r\n          console.log(\"data: \", data);\r\n          if (total !== 0)\r\n            return actions.order.create({\r\n              purchase_units: [\r\n                {\r\n                  amount: {\r\n                    value: total,\r\n                  },\r\n                },\r\n              ],\r\n            });\r\n        }}\r\n        style={{\r\n          layout: \"horizontal\",\r\n          label: \"checkout\",\r\n          height: 40,\r\n        }}\r\n      />\r\n    </PayPalScriptProvider>\r\n  );\r\n};\r\n\r\nexport default Paypal;\r\n","import React, { useState, useEffect } from \"react\";\r\nimport axios from \"axios\";\r\nimport { Link } from 'react-router-dom'\r\nimport ArrowBackRoundedIcon from '@mui/icons-material/ArrowBackRounded';\r\nimport \"./Pay.css\";\r\nimport Paypal from \"./Paypal/Paypal\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport OrderTotal from \"./../Global/OrderTotal\";\r\nimport { useStateValue } from \"../../../StateProvider\";\r\nimport { getBasketTotal } from \"../../../reducer\";\r\nimport Footer from \"../Home/Sections/Footer\";\r\n\r\nconst Pay = () => {\r\n  const navigate = useNavigate();\r\n  const state = useStateValue();\r\n  const { userAPI, token } = useStateValue();\r\n  const { email, lastName, name, phone } = userAPI;\r\n  const { userID } = userAPI;\r\n  const [basket, setBasket] = state?.basket;\r\n  const [postalCode] = userAPI?.postalCode;\r\n  const [address] = userAPI?.address;\r\n  const [building] = userAPI?.building;\r\n  const [checkPhone] = userAPI?.checkPhone;\r\n  const [checkEmail] = userAPI?.checkEmail;\r\n  const [checkName] = userAPI?.checkName;\r\n  const [data] = userAPI.postalData;\r\n  const [paymentOption] = userAPI.paymentOption;\r\n  const [deliveryOption] = userAPI.deliveryOption;\r\n  const [takeaway] = userAPI.takeaway;\r\n  const [error, setError] = useState(\"\");\r\n  const [deferLoading, setDeferLoading] = useState(true);\r\n  const [totalWithDelivery, setTotalWithDelivery] = useState(null);\r\n\r\n  useEffect(() => {\r\n    setTotalWithDelivery(\r\n      parseFloat(getBasketTotal(basket)) + parseFloat(data?.deliveryPrice)\r\n    );\r\n  }, [basket, data?.deliveryPrice]);\r\n\r\n  const transactionSuccess = async (paymentData) => {\r\n\r\n    const time = Date.now() + 1983;\r\n    try {\r\n      await axios\r\n        .post(\r\n          \"/api/user/createorder\",\r\n          {\r\n            orders: {\r\n              orderNumber: time,\r\n              userID,\r\n              postalCode,\r\n              address,\r\n              paymentID: paymentData.orderID,\r\n              paymentDetails: paymentData,\r\n              building,\r\n              basket,\r\n              name: name ? name : checkName,\r\n              email: email ? email : checkEmail,\r\n              lastName,\r\n              phone: phone ? phone : checkPhone,\r\n              time,\r\n              total: getBasketTotal(basket),\r\n              deliveryCharges: data?.deliveryPrice,\r\n              deliveryOption,\r\n              paymentOption,\r\n              paymentStatus: \"received\",\r\n              orderStatus: 'pending'\r\n            },\r\n          },\r\n          {\r\n            headers: {\r\n              Authorization: `Bearer ${ token[0] }`,\r\n            },\r\n          }\r\n        )\r\n        .then(() => {\r\n          setBasket([]);\r\n          navigate(`/checkout/ordersuccess/${ time }`);\r\n        });\r\n    } catch (error) {\r\n      setError(error.response.data.error);\r\n    }\r\n  };\r\n\r\n  const transactionSuccessTakeaway = async (paymentData) => {\r\n\r\n    const time = Date.now() + 1983;\r\n    try {\r\n      await axios\r\n        .post(\r\n          \"/api/user/createorder\",\r\n          {\r\n            orders: {\r\n              orderNumber: time,\r\n              userID,\r\n              paymentID: paymentData.orderID,\r\n              paymentDetails: paymentData,\r\n              basket,\r\n              name: name ? name : checkName,\r\n              email: email ? email : checkEmail,\r\n              lastName,\r\n              phone: phone ? phone : checkPhone,\r\n              time,\r\n              total: getBasketTotal(basket),\r\n              deliveryOption,\r\n              paymentOption,\r\n              paymentStatus: \"received\",\r\n              orderStatus: 'pending'\r\n            },\r\n          },\r\n          {\r\n            headers: {\r\n              Authorization: `Bearer ${ token[0] }`,\r\n            },\r\n          }\r\n        )\r\n        .then(() => {\r\n          setBasket([]);\r\n          navigate(`/checkout/ordersuccess/${ time }`);\r\n        });\r\n    } catch (error) {\r\n      setError(error.response.data.error);\r\n    }\r\n  };\r\n\r\n  const orderSubmit = async () => {\r\n    const time = Date.now() + 1983;\r\n    try {\r\n      await axios\r\n        .post(\r\n          \"/api/user/createorder\",\r\n          {\r\n            orders: {\r\n              orderNumber: time,\r\n              userID,\r\n              postalCode,\r\n              address,\r\n              building,\r\n              basket,\r\n              name: name ? name : checkName,\r\n              email: email ? email : checkEmail,\r\n              lastName,\r\n              phone: phone ? phone : checkPhone,\r\n              time,\r\n              total: getBasketTotal(basket),\r\n              deliveryCharges: data?.deliveryPrice,\r\n              deliveryOption,\r\n              paymentOption,\r\n              paymentStatus: \"pending\",\r\n              orderStatus: 'pending'\r\n            },\r\n          },\r\n          {\r\n            headers: {\r\n              Authorization: `Bearer ${ token[0] }`,\r\n            },\r\n          }\r\n        )\r\n        .then(() => {\r\n          setBasket([]);\r\n          navigate(`/checkout/ordersuccess/${ time }`);\r\n        });\r\n    } catch (error) {\r\n      setError(error.response.data.error);\r\n    }\r\n  };\r\n\r\n  const orderSubmitTakeaway = async () => {\r\n    const time = await Date.now() + 1983;\r\n\r\n    try {\r\n      await axios\r\n        .post(\r\n          \"/api/user/createorder\",\r\n          {\r\n            orders: {\r\n              orderNumber: time,\r\n              userID,\r\n              basket,\r\n              name: name ? name : checkName,\r\n              email: email ? email : checkEmail,\r\n              lastName,\r\n              phone: phone ? phone : checkPhone,\r\n              time,\r\n              total: getBasketTotal(basket),\r\n              deliveryOption,\r\n              paymentOption,\r\n              paymentStatus: \"pending\",\r\n              orderStatus: 'pending'\r\n            },\r\n          },\r\n          {\r\n            headers: {\r\n              Authorization: `Bearer ${ token[0] }`,\r\n            },\r\n          }\r\n        )\r\n        .then(() => {\r\n          setBasket([]);\r\n          navigate(`/checkout/ordersuccess/${ time }`);\r\n        });\r\n    } catch (error) {\r\n      setError(error.response.data.error);\r\n    }\r\n  };\r\n\r\n  const transactionError = async () => {\r\n    setError(\"Transaction not successful\");\r\n  };\r\n\r\n  const transactionCancel = async (data) => {\r\n    setError(\"Cancelled Transaction\");\r\n  };\r\n  useEffect(() => {\r\n    if (\r\n      !postalCode ||\r\n      !address ||\r\n      !building ||\r\n      !checkName ||\r\n      !checkEmail ||\r\n      !checkPhone ||\r\n      parseFloat(getBasketTotal(basket))?.toFixed(2) <\r\n      parseFloat(data?.minOrder) ||\r\n      basket.length === 0 ||\r\n      !data\r\n    ) {\r\n      setDeferLoading(true);\r\n    }\r\n    if (\r\n      (postalCode &&\r\n        address &&\r\n        building &&\r\n        checkName &&\r\n        checkEmail &&\r\n        checkPhone &&\r\n        parseFloat(getBasketTotal(basket))?.toFixed(2) >=\r\n        parseInt(data?.minOrder) &&\r\n        basket.length > 0 &&\r\n        data) ||\r\n      (takeaway && checkEmail && checkName && checkPhone)\r\n    ) {\r\n      setDeferLoading(false);\r\n    }\r\n  }, [\r\n    building,\r\n    basket,\r\n    address,\r\n    deferLoading,\r\n    checkName,\r\n    checkEmail,\r\n    checkPhone,\r\n    data?.minOrder,\r\n    takeaway,\r\n    postalCode,\r\n    data,\r\n  ]);\r\n\r\n\r\n  if (error) {\r\n    setTimeout(() => {\r\n      setError(null);\r\n    }, 2000);\r\n  }\r\n  return (\r\n    <>\r\n      <div className=\"paymentOptions\">\r\n        {error && <div className=\"error__box\">{error}</div>}\r\n\r\n        <div className=\"paymentOptions__front-text\">\r\n          <Link to='/checkout'>\r\n            <ArrowBackRoundedIcon />Change Address Info\r\n          </Link>\r\n        </div>\r\n\r\n\r\n        <OrderTotal />\r\n\r\n        <div className=\"paymentOptions-Paypal-btn\">\r\n          {paymentOption === \"paypaldelivery\" ? (\r\n            <>\r\n              <button\r\n                onClick={(e) =>\r\n                  deliveryOption === \"homedelivery\"\r\n                    ? transactionSuccess(\r\n                      { orderID: \"something now\" }\r\n                    )\r\n                    : deliveryOption === \"takeaway\" &&\r\n                    transactionSuccessTakeaway(\r\n                      { orderID: \"something now\" }\r\n                    )\r\n                }\r\n                style={{ padding: \"10px 15px\", margin: \"10px\" }}>\r\n                Pay the bill\r\n              </button>\r\n              <Paypal\r\n                total={\r\n                  deliveryOption === \"takeaway\"\r\n                    ? getBasketTotal(basket)\r\n                    : totalWithDelivery\r\n                }\r\n                onSuccess={\r\n                  deliveryOption === \"homedelivery\"\r\n                    ? transactionSuccess\r\n                    : deliveryOption === \"takeaway\" &&\r\n                    transactionSuccessTakeaway\r\n                }\r\n                onCancel={transactionCancel}\r\n                onError={transactionError}\r\n                setError={setError}\r\n                loading={deferLoading}\r\n              />\r\n            </>\r\n          ) : (\r\n            paymentOption === \"cashondelivery\" && (\r\n              <button\r\n                className=\"paymentOptions-confirmOrder-btn\"\r\n                onClick={\r\n                  deliveryOption === \"homedelivery\"\r\n                    ? orderSubmit\r\n                    : orderSubmitTakeaway\r\n                }>\r\n                Confirm Order\r\n              </button>\r\n            )\r\n          )}\r\n        </div>\r\n      </div>\r\n      <Footer />\r\n    </>\r\n  );\r\n};\r\n\r\nexport default Pay;\r\n"],"sourceRoot":""}